<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Distinct Names (Promise)</title>

</head>

<body>
    <input type="file" id="fileinput" multiple>
    
    <script>
        // Task: Display two lists with every distinct name used for a boy 
        // and every distinct name used for a girl (without any repeated values)

        // Promise that reads a file as text
        function readFileAsText(file) {
            return new Promise(function (resolve) {
                const reader = new FileReader();

                reader.onload = function () {
                    resolve(reader.result);
                };

                reader.readAsText(file);
            });
        }

        // Handle multiple file uploads (import from the folder "names")
        document.getElementById("fileinput").addEventListener("change", function (e) {
            let files = Array.from(e.currentTarget.files);

            let readers = [];

            // Store promises in array
            for (let i = 0; i < files.length; i++) {
                readers.push(readFileAsText(files[i]));
            }

            // Trigger Promises
            Promise.all(readers).then((texts) => {
                // Texts will be an array that contains an item
                // with the text of every selected file
                // ["File1 Content", "File2 Content" ... "FileN Content"]

                // Splits each item of "texts" in a sub-list with 3 items:
                // 0: name, 1: gender, 2: freq
                const lists = texts.map(list => list.split("\n"));

                // Declares two sets which will contain the most popular 
                // female and male names for each selected year
                const female = new Set();
                const male = new Set();

                // Loops trought the lists... 
                lists.forEach((list) => {

                    // Loops trought each list of "lists"...
                    for (let i = 0; i < list.length; i++) {

                        // The female name is the first item 
                        // of each row in list that contains ",F,"
                        if (list[i].includes(",F,")) {

                            let femaleRow = list[i].split(",");
                            female.add(femaleRow[0]);

                        // The male name is the first item 
                        // of each row in list that contains ",M,"
                        } else if (list[i].includes(",M,")) {
                            let maleRow = list[i].split(",");
                            male.add(maleRow[0]);
                        }
                    } // end for loop

                }) // end forEach

                // Displays two lists that containing every distinct name 
                // used for boys and for girls from the selected files	

                console.log(Array.from(female).sort());
                console.log(Array.from(male).sort());


            }) // end Promise.all
        }, false);	
    
    </script>
</body>

</html>